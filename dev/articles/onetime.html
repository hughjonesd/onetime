<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="onetime">
<title>Introduction to onetime • onetime</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to onetime">
<meta property="og:description" content="onetime">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">onetime</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/onetime.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/hughjonesd/onetime/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to onetime</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hughjonesd/onetime/blob/HEAD/vignettes/onetime.Rmd" class="external-link"><code>vignettes/onetime.Rmd</code></a></small>
      <div class="d-none name"><code>onetime.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>Sometimes package authors want to run code only once for a given user
on a given computer. Not just “once per session”, but “only once ever”
or “only once per month” at most. Here are some use cases:</p>
<ul>
<li>Tell users about new features in your package, without annoying them
every time they load it.</li>
<li>Show a message, with the option to hide it in future.</li>
<li>Perform cleanup actions only once after an upgrade.</li>
</ul>
<p>The onetime package lets you do this.</p>
<p>Onetime is a lightweight package, with just two package dependencies,
rappdirs and filelock. Its total size including dependencies is less
than 50 Kb. So it is cheap to include as a dependency in your own
package.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>You can install onetime from CRAN like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"onetime"</span><span class="op">)</span></span></code></pre></div>
<p>Next, on the R command line, run</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hughjonesd/onetime" class="external-link">onetime</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/check_ok_to_store.html">check_ok_to_store</a></span><span class="op">(</span>ask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If you haven’t used onetime before, you will be asked if it is OK to
store files in onetime’s configuration directory. Answer <code>Y</code>.
Now you can try out onetime’s functions.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>Let’s use <code><a href="../reference/onetime_warning.html">onetime_message()</a></code> to show a message just once.
On the command line, enter:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-1"</span></span>
<span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"I shall say this only once!"</span>, id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; I shall say this only once!</span></span></code></pre></div>
<p>You should see the message, displayed using the base R
<code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> function.</p>
<p>Now if you enter the same code again:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"I shall say this only once!"</span>, id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>… you won’t see anything! Even if you restart R and again run
<code><a href="../reference/onetime_warning.html">onetime_message()</a></code> with the same <code>id</code>, nothing
will be shown. Onetime has stored a file on your computer to record that
the message was already shown, and it doesn’t show it again.</p>
<p>You still won’t see any message, even if you change the message
itself:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"Does nobody hear the cries of an poor old woman?"</span>, id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>That’s because onetime identifies actions by their <code>id</code>.
If you change the <code>id</code>, you can send a new message:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-2"</span></span>
<span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"I repeat... I shall say this only once!"</span>, id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; I repeat... I shall say this only once!</span></span></code></pre></div>
<p>You aren’t limited to sending messages. You can also give
warnings:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-3"</span></span>
<span><span class="fu"><a href="../reference/onetime_warning.html">onetime_warning</a></span><span class="op">(</span><span class="st">"you cannot expect me to shoot everyone in the town. "</span>,</span>
<span>                <span class="st">"I'm unpopular enough as it is!"</span>, id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: you cannot expect me to shoot everyone in the town. I'm unpopular</span></span>
<span><span class="co">#&gt; enough as it is!</span></span></code></pre></div>
<p>You can print package startup messages using
<code><a href="../reference/onetime_warning.html">onetime_startup_message()</a></code>. If the rlang package is
installed, you can also use <code><a href="../reference/onetime-rlang.html">onetime_rlang_inform()</a></code> and
<code><a href="../reference/onetime-rlang.html">onetime_rlang_warn()</a></code> to print messages and warnings using
rlang format:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-4"</span></span>
<span><span class="fu"><a href="../reference/onetime-rlang.html">onetime_rlang_inform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                       <span class="st">"Let that be a lesson to you."</span>, </span>
<span>                       i <span class="op">=</span> <span class="st">"Never again will you burn my toast."</span></span>
<span>                       <span class="op">)</span>, </span>
<span>                     id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; Let that be a lesson to you.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Never again will you burn my toast.</span></span></code></pre></div>
<p>Underlying all these functions is <code><a href="../reference/onetime_do.html">onetime_do()</a></code>, which
allows you to run arbitrary code just once:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-5"</span></span>
<span><span class="fu"><a href="../reference/onetime_do.html">onetime_do</a></span><span class="op">(</span><span class="fu">light_the_candle_with_the_handle</span><span class="op">(</span><span class="op">)</span>, id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; If we kill him with the pill from the till</span></span>
<span><span class="co">#&gt; by making with it the drug in the jug, you need not</span></span>
<span><span class="co">#&gt; light the candle with the handle on the Gateau from the Chateau!</span></span></code></pre></div>
<p>Onetime uses file locks to avoid race conditions. So even if you use
multiple R processes, a onetime action will be run only once:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># NB: This chunk will only be run on Unix-alikes</span></span>
<span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span>, outfile <span class="op">=</span> <span class="st">"check.txt"</span><span class="op">)</span></span>
<span><span class="va">otd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"onetime.dir"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parSapply</a></span><span class="op">(</span><span class="va">cl</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, otd <span class="op">=</span> <span class="va">otd</span>,</span>
<span>  <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">otd</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>onetime.dir <span class="op">=</span> <span class="va">otd</span><span class="op">)</span></span>
<span>    <span class="fu">onetime</span><span class="fu">::</span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"I will say this only once!"</span>, id <span class="op">=</span> <span class="st">"vignette-6"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt; results</span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt;    19     1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="st">"check.txt"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "starting worker pid=7174 on localhost:11664 at 17:39:50.748"</span></span>
<span><span class="co">#&gt; [2] "starting worker pid=7175 on localhost:11664 at 17:39:50.749"</span></span>
<span><span class="co">#&gt; [3] "I will say this only once!"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="allowing-the-user-to-hide-a-message">Allowing the user to hide a message<a class="anchor" aria-label="anchor" href="#allowing-the-user-to-hide-a-message"></a>
</h2>
<p>Sometimes you may wish to show a message to the user but give them
the option to hide it in future. You can do this with
<code><a href="../reference/onetime_message_confirm.html">onetime_message_confirm()</a></code>.</p>
<p>In interactive sessions, this will ask the user if they want to show
the message again:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-7"</span></span>
<span><span class="fu"><a href="../reference/onetime_message_confirm.html">onetime_message_confirm</a></span><span class="op">(</span></span>
<span>  <span class="st">"What are you doing with that serving girl in your arms?"</span>,</span>
<span>  id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; What are you doing with that serving girl in your arms?</span></span>
<span><span class="co">#&gt; Show this message again? [yN]</span></span></code></pre>
<p>In non-interactive sessions, it will tell the user how they can hide
the message in future:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-8"</span></span>
<span><span class="fu"><a href="../reference/onetime_message_confirm.html">onetime_message_confirm</a></span><span class="op">(</span><span class="st">"One drink and... all is quiet on the Western Front."</span>, </span>
<span>            id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; One drink and... all is quiet on the Western Front.</span></span>
<span><span class="co">#&gt; To hide this message in future, run:</span></span>
<span><span class="co">#&gt;   onetime_mark_as_done(id = "vignette-8")</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-an-expiry-time">Setting an expiry time<a class="anchor" aria-label="anchor" href="#setting-an-expiry-time"></a>
</h2>
<p>You can set an expiry time by passing a <code><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime()</a></code>
object to the <code>expiry</code> argument of these functions. For
example, this will print a message, but only if it has not been printed
in the past week:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-9"</span></span>
<span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"Good moaning!"</span>, </span>
<span>                id <span class="op">=</span> <span class="va">id</span>, </span>
<span>                expiry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">as.difftime</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"weeks"</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span><span class="co">#&gt; Good moaning!</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-onetime-in-your-package">Using onetime in your package<a class="anchor" aria-label="anchor" href="#using-onetime-in-your-package"></a>
</h2>
<p>Onetime works by writing a file, typically to a folder in the user’s
configuration directory. As a package author, it is your responsibility
to check for permission to store lockfiles. CRAN policy demands that you
do this. Onetime functions will check for this permission, and by
default won’t store the file until it has been granted.</p>
<p>You have several options to handle this:</p>
<ul>
<li>
<p>If your package is used directly from the command line, the
simplest option is to call functions using
<code>without_permission = "ask"</code>. This will ask the user for
permission to store files if it has not been granted. If not, the action
won’t be run.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-10"</span></span>
<span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"Thank you for your kind applause."</span>, </span>
<span>                id <span class="op">=</span> <span class="va">id</span>,</span>
<span>                without_permission <span class="op">=</span> <span class="st">"ask"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; The onetime package requests to store files in '~/Library/Application Support/onetime'.</span></span>
<span><span class="co">#&gt; Is this OK? [Yn]</span></span>
<span><span class="co">#&gt; Thank you for your kind applause.</span></span></code></pre>
</li>
<li>
<p>If you want more control over when and how you ask users, you can
call <code>check_ok_to_store(ask = TRUE)</code> manually before using
onetime functions.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_ok_to_store.html">check_ok_to_store</a></span><span class="op">(</span></span>
<span>  ask <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  message <span class="op">=</span> <span class="st">"Please let this package store files in your config directory '%s'."</span>,</span>
<span>  confirm_prompt <span class="op">=</span> <span class="st">"OK? (Y/N)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Please let this package store files in your config directory'~/Library/Application Support/onetime'</span></span>
<span><span class="co">#&gt; OK? (Y/N)</span></span></code></pre>
</li>
<li>
<p>In code which might be run non-interactively, or as part of a
long-running command, you can manually call
<code>set_ok_to_store(TRUE)</code> before you use other onetime
functions. This will grant permission to store files, and will print a
warning to the user explaining how they can change this:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_ok_to_store.html">set_ok_to_store</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Granting the onetime package permission to store lockfiles on this computer.</span></span>
<span><span class="co">#&gt; Lockfiles are stored beneath '/tmp/Rtmptwqcr1'.</span></span>
<span><span class="co">#&gt; You can revoke permission by calling:</span></span>
<span><span class="co">#&gt;   onetime::set_ok_to_store(FALSE)</span></span></code></pre></div>
</li>
<li>
<p>By default, configuration files are stored beneath
<code><a href="https://rappdirs.r-lib.org/reference/user_data_dir.html" class="external-link">rappdirs::user_config_dir()</a></code>. If you want to store
configuration files in a non-standard directory, set
<code>options(onetime.dir = &lt;path to directory&gt;)</code>. When this
option is set, onetime assumes that permission has been granted. So, you
can also use this approach to avoid raising the issue of permissions
with the user - so long as you don’t plan to submit your package to
CRAN.</p>
<p>Use this mechanism with care. Package authors should <em>always</em>
set <code>options(onetime.dir)</code> locally within their functions and
set it back to its original value afterwards. Otherwise you risk
changing the directory for other packages, or overwriting the user’s
preferred value. You can do this using
<code><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">withr::local_options()</a></code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_func</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">local_options</a></span><span class="op">(</span>onetime.dir <span class="op">=</span> <span class="st">"path to preferred directory"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"Hit it hard with your spoon."</span>,</span>
<span>                  <span class="st">"They always break in the end."</span>,</span>
<span>                  id <span class="op">=</span> <span class="st">"flick-1"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>or in base R:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_func</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">oo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>onetime.dir <span class="op">=</span> <span class="st">"path to preferred directory"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">oo</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
</ul>
<p>If onetime has already been installed by a different package, then it
is likely that the user will have already granted file permissions, and
onetime functions will just work.</p>
</div>
<div class="section level2">
<h2 id="utility-functions">Utility functions<a class="anchor" aria-label="anchor" href="#utility-functions"></a>
</h2>
<p><code><a href="../reference/onetime_been_done.html">onetime_been_done()</a></code> checks whether an action has been
performed:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/onetime_been_done.html">onetime_been_done</a></span><span class="op">(</span><span class="st">"vignette-1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/onetime_been_done.html">onetime_been_done</a></span><span class="op">(</span><span class="st">"vignette-unused"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>To reset a particular id, so that functions will be run again, use
<code><a href="../reference/onetime_reset.html">onetime_reset()</a></code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/onetime_reset.html">onetime_reset</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"vignette-1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"I shall say this only once!"</span>, id <span class="op">=</span> <span class="st">"vignette-1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; I shall say this only once!</span></span></code></pre></div>
<p>From version 0.2.0 of the package, you can use
<code><a href="../reference/onetime_mark_as_done.html">onetime_mark_as_done()</a></code> to manually mark a particular action
as done:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"vignette-11"</span></span>
<span><span class="fu"><a href="../reference/onetime_mark_as_done.html">onetime_mark_as_done</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co"># Won't be shown:</span></span>
<span><span class="fu"><a href="../reference/onetime_warning.html">onetime_message</a></span><span class="op">(</span><span class="st">"In my opinion, a whole Meccano set has fallen apart in there."</span>,</span>
<span>            id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="going-further">Going further<a class="anchor" aria-label="anchor" href="#going-further"></a>
</h2>
<p>More information is available on the onetime website:</p>
<ul>
<li><a href="https://hughjonesd.github.io/onetime">CRAN version</a></li>
<li><a href="https://hughjonesd.github.io/onetime/dev">Development
version</a></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Hugh-Jones.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
